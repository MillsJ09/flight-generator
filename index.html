<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Random Flight Generator</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --color-bg-light: #f9fafb;
      --color-bg-dark: #121212;
      --color-text-light: #333;
      --color-text-dark: #ddd;
      --color-primary: #3182ce;
      --color-primary-dark: #90cdf4;
      --color-bg-form-light: #fff;
      --color-bg-form-dark: #1f1f1f;
      --color-bg-table-light: #fff;
      --color-bg-table-dark: #252525;
      --color-row-hover-light: #ebf8ff;
      --color-row-hover-dark: #2a3a4d;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      max-width: 700px;
      margin: 30px auto;
      padding: 0 20px;
      background: var(--color-bg-light);
      color: var(--color-text-light);
      transition: background 0.3s ease, color 0.3s ease;
    }

    body.dark {
      background: var(--color-bg-dark);
      color: var(--color-text-dark);
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
    }

    form {
      background: var(--color-bg-form-light);
      padding: 25px 30px;
      border-radius: 8px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }

    body.dark form {
      background: var(--color-bg-form-dark);
      box-shadow: 0 3px 15px rgba(0,0,0,0.8);
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      margin-top: 20px;
    }

    input[type="text"], select {
      width: 100%;
      padding: 12px 15px;
      border: 1.8px solid #cbd5e0;
      border-radius: 6px;
      font-size: 1rem;
      background: #fff;
      color: #222;
    }

    input[type="text"]:focus, select:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 6px var(--color-primary-dark);
    }

    body.dark input[type="text"],
    body.dark select {
      background: #222;
      color: #eee;
      border-color: #555;
    }

    body.dark input[type="text"]:focus,
    body.dark select:focus {
      border-color: var(--color-primary);
      box-shadow: 0 0 6px var(--color-primary-dark);
    }

    button {
      margin-top: 30px;
      width: 100%;
      background: var(--color-primary);
      color: white;
      font-weight: 600;
      font-size: 1.1rem;
      padding: 12px 0;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    button:hover {
      background: #2b6cb0;
    }

    #results {
      margin-top: 30px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: var(--color-bg-table-light);
      transition: background 0.3s ease;
    }

    body.dark table {
      background: var(--color-bg-table-dark);
    }

    th, td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }

    thead {
      background: var(--color-primary);
      color: white;
    }

    tbody tr:hover {
      background: var(--color-row-hover-light);
    }

    body.dark tbody tr:hover {
      background: var(--color-row-hover-dark);
    }

    #toggleDark {
      position: fixed;
      top: 18px;
      right: 20px;
      background: var(--color-primary);
      border: none;
      border-radius: 50%;
      width: 38px;
      height: 38px;
      font-size: 20px;
      line-height: 38px;
      color: white;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      z-index: 9999;
      text-align: center;
    }

    #toggleDark:hover {
      background: #2b6cb0;
    }
  </style>
</head>
<body>

<button id="toggleDark" aria-label="Toggle light/dark mode">ðŸŒ™</button>

<h1>Random Flight Generator</h1>

<form id="flightForm" autocomplete="off">
  <label for="depAirport">Starting Airport (ICAO):</label>
  <input type="text" id="depAirport" placeholder="e.g. EGJB" maxlength="4" required />

  <label for="aircraft">Select Aircraft:</label>
  <select id="aircraft" required>
    <option value="">-- Select Aircraft --</option>
  </select>

  <button type="submit">Generate Flights</button>
</form>

<div id="results"></div>

<script>
let airports = [
  { "icao": "EGJB", "name": "Guernsey", "lat": 49.4343, "lon": -2.5895 },
  { "icao": "EGKK", "name": "London Gatwick", "lat": 51.1481, "lon": -0.1903 },
  { "icao": "EGLL", "name": "London Heathrow", "lat": 51.4700, "lon": -0.4543 },
  { "icao": "LFPG", "name": "Paris Charles de Gaulle", "lat": 49.0097, "lon": 2.5479 },
  { "icao": "EDDF", "name": "Frankfurt", "lat": 50.0379, "lon": 8.5622 },
  { "icao": "EGPH", "name": "Edinburgh", "lat": 55.9500, "lon": -3.3725 },
  { "icao": "EIDW", "name": "Dublin", "lat": 53.4213, "lon": -6.2701 },
  { "icao": "LEMD", "name": "Madrid Barajas", "lat": 40.4719, "lon": -3.5626 },
  { "icao": "EGMC", "name": "Southampton", "lat": 50.9508, "lon": -1.3561 },
  { "icao": "EGSS", "name": "London Stansted", "lat": 51.8850, "lon": 0.2350 }
];

let aircraftData = {};

document.addEventListener('DOMContentLoaded', () => {
  loadAircraftData();
  updateToggleIcon();
});

async function loadAircraftData() {
  try {
    const response = await fetch('aircraft.json');
    aircraftData = await response.json();

    const aircraftSelect = document.getElementById('aircraft');
    Object.keys(aircraftData).forEach(code => {
      const option = document.createElement('option');
      option.value = code;
      option.textContent = `${code} (${aircraftData[code].range} NM)`;
      aircraftSelect.appendChild(option);
    });
  } catch (error) {
    console.error('Failed to load aircraft data:', error);
    alert('Could not load aircraft data. Please check aircraft.json.');
  }
}

function calculateDistance(lat1, lon1, lat2, lon2) {
  const toRad = (deg) => (deg * Math.PI) / 180;
  const R = 3440;
  const dLat = toRad(lat2 - lat1);
  const dLon = toRad(lon2 - lon1);
  const a = Math.sin(dLat / 2) ** 2 +
            Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
            Math.sin(dLon / 2) ** 2;
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}

function formatDuration(hours) {
  const h = Math.floor(hours);
  const m = Math.round((hours - h) * 60);
  return `${h}h ${m}m`;
}

function shuffle(array) {
  let currentIndex = array.length, randomIndex;
  while (currentIndex !== 0) {
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex--;
